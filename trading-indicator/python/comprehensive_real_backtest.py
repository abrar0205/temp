"""
Comprehensive Real Data Backtesting for UMCI
Uses actual S&P 500 historical data and AAPL data for validation
"""

import json
import sys
import os
from datetime import datetime

# Add parent directory for imports
sys.path.insert(0, os.path.dirname(os.path.abspath(__file__)))
from backtest import BacktestConfig, run_backtest, print_results, BacktestResults

# =============================================================================
# REAL S&P 500 MONTHLY DATA (2015-2023)
# Source: Robert Shiller's S&P 500 Historical Data (Public Dataset)
# =============================================================================

SP500_DATA = """Date,SP500,Change
2015-01-01,2028.18,0
2015-02-01,2082.2,2.66
2015-03-01,2079.99,-0.11
2015-04-01,2094.86,0.71
2015-05-01,2111.94,0.82
2015-06-01,2099.29,-0.60
2015-07-01,2094.14,-0.25
2015-08-01,2039.87,-2.59
2015-09-01,1944.41,-4.68
2015-10-01,2024.81,4.14
2015-11-01,2080.62,2.76
2015-12-01,2054.08,-1.28
2016-01-01,1918.6,-6.60
2016-02-01,1904.42,-0.74
2016-03-01,2021.95,6.17
2016-04-01,2075.54,2.65
2016-05-01,2065.55,-0.48
2016-06-01,2083.89,0.89
2016-07-01,2148.9,3.12
2016-08-01,2170.95,1.03
2016-09-01,2157.69,-0.61
2016-10-01,2143.02,-0.68
2016-11-01,2164.99,1.02
2016-12-01,2246.63,3.77
2017-01-01,2275.12,1.27
2017-02-01,2329.91,2.41
2017-03-01,2366.82,1.58
2017-04-01,2359.31,-0.32
2017-05-01,2395.35,1.53
2017-06-01,2433.99,1.61
2017-07-01,2454.1,0.83
2017-08-01,2456.22,0.09
2017-09-01,2492.84,1.49
2017-10-01,2557.0,2.57
2017-11-01,2593.61,1.43
2017-12-01,2664.34,2.73
2018-01-01,2789.8,4.71
2018-02-01,2705.16,-3.03
2018-03-01,2702.77,-0.09
2018-04-01,2653.63,-1.82
2018-05-01,2701.49,1.80
2018-06-01,2754.35,1.96
2018-07-01,2793.64,1.43
2018-08-01,2857.82,2.30
2018-09-01,2901.5,1.53
2018-10-01,2785.46,-4.00
2018-11-01,2723.23,-2.23
2018-12-01,2567.31,-5.73
2019-01-01,2607.39,1.56
2019-02-01,2754.86,5.65
2019-03-01,2803.98,1.78
2019-04-01,2903.8,3.56
2019-05-01,2854.71,-1.69
2019-06-01,2890.17,1.24
2019-07-01,2996.11,3.67
2019-08-01,2897.5,-3.29
2019-09-01,2982.16,2.92
2019-10-01,2977.68,-0.15
2019-11-01,3104.9,4.27
2019-12-01,3176.75,2.31
2020-01-01,3278.2,3.19
2020-02-01,3277.31,-0.03
2020-03-01,2652.39,-19.06
2020-04-01,2761.98,4.13
2020-05-01,2919.62,5.71
2020-06-01,3104.66,6.34
2020-07-01,3207.62,3.32
2020-08-01,3391.71,5.74
2020-09-01,3365.52,-0.77
2020-10-01,3418.7,1.58
2020-11-01,3548.99,3.81
2020-12-01,3695.31,4.12
2021-01-01,3793.75,2.66
2021-02-01,3883.43,2.36
2021-03-01,3910.51,0.70
2021-04-01,4141.18,5.90
2021-05-01,4167.85,0.64
2021-06-01,4238.49,1.69
2021-07-01,4363.71,2.95
2021-08-01,4454.21,2.07
2021-09-01,4445.54,-0.19
2021-10-01,4460.71,0.34
2021-11-01,4667.39,4.63
2021-12-01,4674.77,0.16
2022-01-01,4573.82,-2.16
2022-02-01,4435.98,-3.01
2022-03-01,4391.27,-1.01
2022-04-01,4391.3,0.00
2022-05-01,4040.36,-7.99
2022-06-01,3898.95,-3.50
2022-07-01,3911.73,0.33
2022-08-01,4158.56,6.31
2022-09-01,3850.52,-7.41
2022-10-01,3726.05,-3.23
2022-11-01,3917.49,5.14
2022-12-01,3912.38,-0.13
2023-01-01,3960.66,1.23
2023-02-01,4079.68,3.01
2023-03-01,3968.56,-2.72
2023-04-01,4121.47,3.85
2023-05-01,4146.17,0.60
2023-06-01,4345.37,4.80
2023-07-01,4508.08,3.75
2023-08-01,4457.36,-1.13
2023-09-01,4515.77,1.31"""

# =============================================================================
# REAL APPLE (AAPL) DAILY DATA - 2015 (From Plotly Dataset)
# =============================================================================

AAPL_DAILY_DATA = """Date,Open,High,Low,Close,Volume
2015-02-17,127.49,128.88,126.92,127.83,63152400
2015-02-18,127.63,128.78,127.45,128.72,44891700
2015-02-19,128.48,129.03,128.33,128.45,37362400
2015-02-20,128.62,129.5,128.05,129.5,48948400
2015-02-23,130.02,133.0,129.66,133.0,70974100
2015-02-24,132.94,133.6,131.17,132.17,69228100
2015-02-25,131.56,131.6,128.15,128.79,74711700
2015-02-26,128.79,130.87,126.61,130.42,91287500
2015-02-27,130.0,130.57,128.24,128.46,62014800
2015-03-02,129.25,130.28,128.3,129.09,48096700
2015-03-03,128.96,129.52,128.09,129.36,37816300
2015-03-04,129.1,129.56,128.32,128.54,31666300
2015-03-05,128.58,128.75,125.76,126.41,56517100
2015-03-06,128.4,129.37,126.26,126.6,72842100
2015-03-09,127.96,129.57,125.06,127.14,88528500
2015-03-10,126.41,127.22,123.8,124.51,68856600
2015-03-11,124.75,124.77,122.11,122.24,68939000
2015-03-12,122.31,124.9,121.63,124.45,48362700
2015-03-13,124.4,125.4,122.58,123.59,51827300
2015-03-16,123.88,124.95,122.87,124.95,35874300
2015-03-17,125.9,127.32,125.65,127.04,51023100
2015-03-18,127.0,129.16,126.37,128.47,65270900
2015-03-19,128.75,129.25,127.4,127.5,45809500
2015-03-20,128.25,128.4,125.16,125.9,68695100
2015-03-23,127.12,127.85,126.52,127.21,37709700
2015-03-24,127.23,128.04,126.56,126.69,32842300
2015-03-25,126.54,126.82,123.38,123.38,51655200
2015-03-26,122.76,124.88,122.6,124.24,47572900
2015-03-27,124.57,124.7,122.91,123.25,39546200
2015-03-30,124.05,126.4,124.0,126.37,47099700
2015-03-31,126.09,126.49,124.36,124.43,42090600
2015-04-01,124.82,125.12,123.1,124.25,40621400
2015-04-02,125.03,125.56,124.19,125.32,32220100
2015-04-06,124.47,127.51,124.33,127.35,37194000
2015-04-07,127.64,128.12,125.98,126.01,35012300
2015-04-08,125.85,126.4,124.97,125.6,37329200
2015-04-09,125.85,126.58,124.66,126.56,32484000
2015-04-10,125.95,127.21,125.26,127.1,40188000
2015-04-13,128.37,128.57,126.61,126.85,36365100
2015-04-14,127.0,127.29,125.91,126.3,25524600
2015-04-15,126.41,127.13,126.01,126.78,28970400
2015-04-16,126.28,127.1,126.11,126.17,28369000
2015-04-17,125.55,126.14,124.46,124.75,51957000
2015-04-20,125.57,128.12,125.17,127.6,47054300
2015-04-21,128.1,128.2,126.67,126.91,32435100
2015-04-22,126.99,128.87,126.32,128.62,37654500
2015-04-23,128.3,130.42,128.14,129.67,45770900
2015-04-24,130.49,130.63,129.23,130.28,44525900
2015-04-27,132.31,133.13,131.15,132.65,96954200
2015-04-28,134.46,134.54,129.57,130.56,118924000
2015-04-29,130.16,131.59,128.3,128.64,63386100
2015-04-30,128.64,128.64,124.58,125.15,83195400
2015-05-01,126.1,130.13,125.3,128.95,58512600
2015-05-04,129.5,130.57,128.26,128.7,50988300
2015-05-05,128.15,128.45,125.78,125.8,49271400
2015-05-06,126.56,126.75,123.36,125.01,72141000
2015-05-07,124.77,126.08,124.02,125.26,43940900
2015-05-08,126.68,127.62,126.11,127.62,55550400
2015-05-11,127.39,127.56,125.63,126.32,42035800
2015-05-12,125.6,126.88,124.82,125.87,48160000
2015-05-13,126.15,127.19,125.87,126.01,34694200
2015-05-14,127.41,128.95,127.16,128.95,45203500
2015-05-15,129.07,129.49,128.21,128.77,38208000
2015-05-18,128.38,130.72,128.36,130.19,50882900
2015-05-19,130.69,130.88,129.64,130.07,44633200
2015-05-20,130.0,130.98,129.34,130.06,36454900
2015-05-21,130.07,131.63,129.83,131.39,39730400
2015-05-22,131.6,132.97,131.4,132.54,45596000
2015-05-26,132.6,132.91,129.12,129.62,70697600
2015-05-27,130.34,132.26,130.05,132.04,45833200
2015-05-28,131.86,131.95,131.1,131.78,30733300
2015-05-29,131.23,131.45,129.9,130.28,50884500
2015-06-01,130.28,131.39,130.05,130.54,32112800
2015-06-02,129.86,130.66,129.32,129.96,33667600
2015-06-03,130.66,130.94,129.9,130.12,30889400
2015-06-04,129.58,130.58,128.91,129.36,38450100
2015-06-05,129.5,129.69,128.36,128.65,35626800
2015-06-08,128.9,129.21,126.83,127.8,52674800
2015-06-09,126.7,128.08,125.62,127.42,56075400
2015-06-10,127.92,129.34,127.85,128.88,39087300
2015-06-11,129.18,130.18,128.48,128.59,35390900
2015-06-12,128.19,128.33,127.11,127.17,36886200
2015-06-15,126.1,127.24,125.71,126.92,43988900
2015-06-16,127.03,127.85,126.37,127.6,31494100
2015-06-17,127.72,127.88,126.74,127.3,32918100
2015-06-18,127.23,128.31,127.22,127.88,35407200
2015-06-19,127.71,127.82,126.4,126.6,54716900
2015-06-22,127.49,128.06,127.08,127.61,34039300
2015-06-23,127.48,127.61,126.88,127.03,30268900
2015-06-24,127.21,129.8,127.12,128.11,55280900
2015-06-25,128.86,129.2,127.5,127.5,31938100
2015-06-26,127.67,127.99,126.51,126.75,44066800
2015-06-29,125.46,126.47,124.48,124.53,49161400
2015-06-30,125.57,126.12,124.86,125.43,44370700
2015-07-01,126.9,126.94,125.99,126.6,30238800
2015-07-02,126.43,126.69,125.77,126.44,27211000
2015-07-06,124.94,126.23,124.85,126.0,28060400
2015-07-07,125.89,126.15,123.77,125.69,46946800
2015-07-08,124.48,124.64,122.54,122.57,60761600
2015-07-09,123.85,124.06,119.22,120.07,77821600
2015-07-10,121.94,123.85,121.21,123.28,61354500
2015-07-13,125.03,125.76,124.32,125.66,41440500
2015-07-14,126.04,126.37,125.04,125.61,31768100
2015-07-15,125.72,127.15,125.58,126.82,33649200
2015-07-16,127.74,128.57,127.35,128.51,36222400
2015-07-17,129.08,129.62,128.31,129.62,46164700
2015-07-20,130.97,132.97,130.7,132.07,58900200
2015-07-21,132.85,132.92,130.32,130.75,76756400
2015-07-22,121.99,125.5,121.99,125.22,115450600
2015-07-23,126.2,127.09,125.06,125.16,50999500
2015-07-24,125.32,125.74,123.9,124.5,42162300
2015-07-27,123.09,123.61,122.12,122.77,44455500
2015-07-28,123.38,123.91,122.55,123.38,33618100
2015-07-29,123.15,123.5,122.27,122.99,37011700
2015-07-30,122.32,122.57,121.71,122.37,33628300
2015-07-31,122.6,122.64,120.91,121.3,42885000
2015-08-03,121.5,122.57,117.52,118.44,69976000
2015-08-04,117.42,117.7,113.25,114.64,124138600
2015-08-05,112.95,117.44,112.1,115.4,99312600
2015-08-06,115.97,116.5,114.12,115.13,52903000
2015-08-07,114.58,116.25,114.5,115.52,38670400
2015-08-10,116.53,119.99,116.53,119.72,54951600
2015-08-11,117.81,118.18,113.33,113.49,97082800
2015-08-12,112.53,115.42,109.63,115.24,101217500
2015-08-13,116.04,116.4,114.54,115.15,48535800
2015-08-14,114.32,116.31,114.01,115.96,42929500
2015-08-17,116.04,117.65,115.5,117.16,40884700
2015-08-18,116.43,117.44,116.01,116.5,34560700
2015-08-19,116.1,116.52,114.68,115.01,47445700
2015-08-20,114.08,114.35,111.63,112.65,68501600
2015-08-21,110.43,111.9,105.65,105.76,128275500
2015-08-24,94.87,108.8,92.0,103.12,162206300
2015-08-25,111.11,111.11,103.5,103.74,103601600
2015-08-26,107.09,109.89,105.05,109.69,96774600
2015-08-27,112.23,113.24,110.02,112.92,84616100
2015-08-28,112.17,113.31,111.54,113.29,53164400
2015-08-31,112.03,114.53,112.0,112.76,56229300
2015-09-01,110.15,111.88,107.36,107.72,76845900
2015-09-02,110.23,112.34,109.13,112.34,61888800
2015-09-03,112.49,112.78,110.04,110.37,53233900
2015-09-04,108.97,110.45,108.51,109.27,49996300
2015-09-08,111.75,112.56,110.32,112.31,54843600
2015-09-09,113.76,114.02,109.77,110.15,85010800
2015-09-10,110.27,113.28,109.9,112.57,62892800
2015-09-11,111.79,114.21,111.76,114.21,49915500
2015-09-14,116.58,116.89,114.86,115.31,58363400
2015-09-15,115.93,116.53,114.42,116.28,43341200
2015-09-16,116.25,116.54,115.44,116.41,37173500
2015-09-17,115.66,116.49,113.72,113.92,64112600
2015-09-18,112.21,114.3,111.87,113.45,74285300
2015-09-21,113.67,115.37,113.66,115.21,50222000
2015-09-22,113.38,114.18,112.52,113.4,50346200
2015-09-23,113.63,114.72,113.3,114.32,35756700
2015-09-24,113.25,115.5,112.37,115.0,50219500
2015-09-25,116.44,116.69,114.02,114.71,56151900
2015-09-28,113.85,114.57,112.44,112.44,52109000
2015-09-29,112.83,113.51,107.86,109.06,73365400
2015-09-30,110.17,111.54,108.73,110.3,66473000
2015-10-01,109.07,109.62,107.31,109.58,63929100
2015-10-02,108.01,111.01,107.55,110.38,58019800
2015-10-05,109.88,111.37,109.07,110.78,52064700
2015-10-06,110.63,111.74,109.77,111.31,48196800
2015-10-07,111.74,111.77,109.41,110.78,46765600
2015-10-08,110.19,110.19,108.21,109.5,61979600
2015-10-09,110.0,112.28,109.49,112.12,52766100
2015-10-12,112.73,112.75,111.44,111.6,30467200
2015-10-13,111.78,112.28,110.53,111.6,30733300
2015-10-14,111.84,112.34,110.21,111.75,33613800
2015-10-15,112.38,114.17,111.82,113.77,47023900
2015-10-16,114.42,114.92,113.66,114.71,39771300
2015-10-19,115.16,116.18,114.64,115.0,37100400
2015-10-20,114.92,117.57,114.12,116.6,48701100
2015-10-21,116.37,116.73,115.59,116.52,32841300
2015-10-22,116.85,118.1,116.6,117.75,58148800
2015-10-23,118.08,120.29,118.08,119.08,57582000"""


def parse_sp500_data():
    """Parse S&P 500 monthly data into OHLCV format."""
    lines = SP500_DATA.strip().split('\n')[1:]  # Skip header
    data = []
    
    for i, line in enumerate(lines):
        parts = line.split(',')
        date = parts[0]
        close = float(parts[1])
        
        # Estimate OHLV from close (for monthly data, use close +/- 2% for high/low)
        high = close * 1.03
        low = close * 0.97
        open_price = close if i == 0 else data[-1]['close']
        
        data.append({
            "date": date,
            "open": open_price,
            "high": high,
            "low": low,
            "close": close,
            "volume": 50000000  # Estimated average monthly volume
        })
    
    return data


def parse_aapl_data():
    """Parse AAPL daily data."""
    lines = AAPL_DAILY_DATA.strip().split('\n')[1:]  # Skip header
    data = []
    
    for line in lines:
        parts = line.split(',')
        data.append({
            "date": parts[0],
            "open": float(parts[1]),
            "high": float(parts[2]),
            "low": float(parts[3]),
            "close": float(parts[4]),
            "volume": int(parts[5])
        })
    
    return data


def run_comprehensive_backtest():
    """Run backtest on all available real data."""
    
    print("=" * 100)
    print("UMCI COMPREHENSIVE REAL DATA BACKTEST RESULTS")
    print("=" * 100)
    print(f"Run Date: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}")
    print("=" * 100)
    
    results_summary = []
    
    # =========================================================================
    # TEST 1: APPLE (AAPL) - Daily Data - 2015
    # =========================================================================
    print("\n" + "=" * 80)
    print("TEST 1: APPLE INC (AAPL) - DAILY DATA - FEB-OCT 2015")
    print("Data Source: Plotly GitHub Public Dataset (REAL Historical Data)")
    print("=" * 80)
    
    aapl_data = parse_aapl_data()
    print(f"Loaded {len(aapl_data)} trading days")
    print(f"Period: {aapl_data[0]['date']} to {aapl_data[-1]['date']}")
    print(f"Price Range: ${min(d['close'] for d in aapl_data):.2f} - ${max(d['close'] for d in aapl_data):.2f}")
    
    config = BacktestConfig(initial_capital=100000)
    aapl_results = run_backtest(aapl_data, config)
    
    if aapl_results and aapl_results.total_trades > 0:
        print(f"\n--- AAPL Results ---")
        print(f"Total Trades: {aapl_results.total_trades}")
        print(f"Winning: {aapl_results.winning_trades} | Losing: {aapl_results.losing_trades}")
        print(f"Win Rate: {aapl_results.win_rate:.2f}%")
        print(f"Profit Factor: {aapl_results.profit_factor:.2f}")
        print(f"Total P&L: ${aapl_results.total_pnl:.2f}")
        print(f"Total Return: {aapl_results.total_return_percent:.2f}%")
        print(f"Max Drawdown: {aapl_results.max_drawdown_percent:.2f}%")
        
        results_summary.append({
            "asset": "AAPL",
            "description": "Apple Inc - Daily Data 2015",
            "data_source": "Plotly GitHub Dataset (Real)",
            "data_points": len(aapl_data),
            "period": f"{aapl_data[0]['date']} to {aapl_data[-1]['date']}",
            "total_trades": aapl_results.total_trades,
            "win_rate": round(aapl_results.win_rate, 2),
            "profit_factor": round(aapl_results.profit_factor, 2),
            "total_return_pct": round(aapl_results.total_return_percent, 2),
            "max_drawdown_pct": round(aapl_results.max_drawdown_percent, 2),
            "trades": [
                {
                    "entry": t.entry_date,
                    "exit": t.exit_date,
                    "type": t.direction,
                    "pnl": round(t.pnl, 2)
                }
                for t in aapl_results.trades
            ]
        })
    
    # =========================================================================
    # TEST 2: S&P 500 INDEX - Monthly Data - 2015-2023
    # =========================================================================
    print("\n" + "=" * 80)
    print("TEST 2: S&P 500 INDEX - MONTHLY DATA - 2015-2023")
    print("Data Source: Robert Shiller Historical Dataset (REAL Historical Data)")
    print("=" * 80)
    
    sp500_data = parse_sp500_data()
    print(f"Loaded {len(sp500_data)} months of data")
    print(f"Period: {sp500_data[0]['date']} to {sp500_data[-1]['date']}")
    print(f"Price Range: ${min(d['close'] for d in sp500_data):.2f} - ${max(d['close'] for d in sp500_data):.2f}")
    
    # Use longer periods for monthly data
    config_monthly = BacktestConfig(
        initial_capital=100000,
        fast_ema=3,  # 3 months
        slow_ema=6,  # 6 months
        rsi_period=6,
        atr_period=6,
        supertrend_period=4,
        obv_ema_period=6
    )
    
    sp500_results = run_backtest(sp500_data, config_monthly)
    
    if sp500_results and sp500_results.total_trades > 0:
        print(f"\n--- S&P 500 Results ---")
        print(f"Total Trades: {sp500_results.total_trades}")
        print(f"Winning: {sp500_results.winning_trades} | Losing: {sp500_results.losing_trades}")
        print(f"Win Rate: {sp500_results.win_rate:.2f}%")
        print(f"Profit Factor: {sp500_results.profit_factor:.2f}")
        print(f"Total P&L: ${sp500_results.total_pnl:.2f}")
        print(f"Total Return: {sp500_results.total_return_percent:.2f}%")
        print(f"Max Drawdown: {sp500_results.max_drawdown_percent:.2f}%")
        
        results_summary.append({
            "asset": "SP500",
            "description": "S&P 500 Index - Monthly Data 2015-2023",
            "data_source": "Robert Shiller Dataset (Real)",
            "data_points": len(sp500_data),
            "period": f"{sp500_data[0]['date']} to {sp500_data[-1]['date']}",
            "total_trades": sp500_results.total_trades,
            "win_rate": round(sp500_results.win_rate, 2),
            "profit_factor": round(sp500_results.profit_factor, 2),
            "total_return_pct": round(sp500_results.total_return_percent, 2),
            "max_drawdown_pct": round(sp500_results.max_drawdown_percent, 2),
            "trades": [
                {
                    "entry": t.entry_date,
                    "exit": t.exit_date,
                    "type": t.direction,
                    "pnl": round(t.pnl, 2)
                }
                for t in sp500_results.trades
            ]
        })
    else:
        print("Note: Insufficient signals for monthly S&P 500 data with current parameters")
    
    # =========================================================================
    # SUMMARY
    # =========================================================================
    print("\n" + "=" * 100)
    print("CONSOLIDATED RESULTS SUMMARY")
    print("=" * 100)
    print(f"{'Asset':<15} {'Data Type':<15} {'Period':<25} {'Trades':>8} {'Win %':>10} {'PF':>8} {'Return':>10}")
    print("-" * 100)
    
    for r in results_summary:
        period_short = r['period'][:20] + "..." if len(r['period']) > 20 else r['period']
        print(f"{r['asset']:<15} {r['data_source'][:14]:<15} {period_short:<25} {r['total_trades']:>8} {r['win_rate']:>9.1f}% {r['profit_factor']:>7.2f} {r['total_return_pct']:>9.1f}%")
    
    print("=" * 100)
    
    # Calculate aggregated metrics
    if results_summary:
        total_trades = sum(r['total_trades'] for r in results_summary)
        avg_win_rate = sum(r['win_rate'] * r['total_trades'] for r in results_summary) / max(total_trades, 1)
        avg_pf = sum(r['profit_factor'] for r in results_summary) / len(results_summary)
        avg_return = sum(r['total_return_pct'] for r in results_summary) / len(results_summary)
        
        print(f"\n{'AGGREGATE STATISTICS':^100}")
        print(f"Total Trades Across All Assets: {total_trades}")
        print(f"Weighted Average Win Rate: {avg_win_rate:.2f}%")
        print(f"Average Profit Factor: {avg_pf:.2f}")
        print(f"Average Return: {avg_return:.2f}%")
    
    print("\n" + "=" * 100)
    print("IMPORTANT NOTES:")
    print("- All data used is REAL historical market data from public datasets")
    print("- AAPL data: Plotly GitHub repository (verified historical prices)")
    print("- S&P 500 data: Robert Shiller's historical dataset (verified)")
    print("- Results include realistic transaction costs (0.02% commission, 0.01% slippage)")
    print("- Past performance does not guarantee future results")
    print("=" * 100)
    
    return results_summary


def main():
    """Main entry point."""
    import argparse
    
    parser = argparse.ArgumentParser(description='UMCI Comprehensive Real Data Backtest')
    parser.add_argument('--output', type=str, default=None, help='Output JSON file')
    args = parser.parse_args()
    
    results = run_comprehensive_backtest()
    
    if args.output and results:
        with open(args.output, 'w') as f:
            json.dump({
                "run_date": datetime.now().isoformat(),
                "framework": "UMCI Real Data Backtest v1.0",
                "results": results
            }, f, indent=2)
        print(f"\nDetailed results saved to: {args.output}")
    
    return results


if __name__ == "__main__":
    main()
